{
  "commands": [
    "#!/bin/bash",
    "set -e",
    "yum update -y",
    "yum install -y java-21-amazon-corretto",
    "mkdir -p /home/ec2-user/minecraft-server",
    "cd /home/ec2-user/minecraft-server",
    "wget -O server.jar https://piston-data.mojang.com/v1/objects/e6ec2f64e6080b9b5d9b471b291c33cc7f509733/server.jar",
    "echo \"eula=true\" > eula.txt",
    "chown -R ec2-user:ec2-user /home/ec2-user/minecraft-server",
    "cat <<EOF > /etc/systemd/system/minecraft.service",
    "[Unit]",
    "Description=Minecraft Server",
    "After=network.target",
    "",
    "[Service]",
    "User=ec2-user",
    "Nice=1",
    "KillMode=mixed",
    "SuccessExitStatus=0 143",
    "ProtectHome=false",
    "WorkingDirectory=/home/ec2-user/minecraft-server",
    "ExecStart=/usr/bin/java -Xmx2G -Xms1G -jar server.jar nogui",
    "Restart=on-failure",
    "",
    "[Install]",
    "WantedBy=multi-user.target",
    "EOF",
    "systemctl daemon-reload",
    "systemctl enable minecraft",
    "systemctl start minecraft"
  ]
}
